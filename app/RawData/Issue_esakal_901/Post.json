{
    "active_lock_reason": "too heated",
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "<!--- Provide a general summary of the issue in the Title above -->\r\nMany libraries in the Angular ecosystem publish to NPM from a subdirectory that was cooked during the build process. The process is usually as followed:\r\n- build the library in a subdirectory (i.e `dist` directory)\r\n- copy package.json, license and readme to the `dist` directory\r\n- do some package.json cleanups in the `dist` directory (delete devDepedencies, move dependencies to peerDependencies, remove scripts...)\r\n- npm publish from the `dist` directory.\r\n\r\nI understand that it is not a common technique for node.js package developers but i think it is common for web package developers and my libraries uses the same technique..\r\n\r\nWhile embedding `lerna` into our shared packages monorepo - [kaltura-ng](https://github.com/kaltura/kaltura-ng) I read a lot of issues in lerna and googled about this topic. I read carefully the conversation of issue #91 and even used the same subject with my issue. Unless I missed new issues that address this feature it was marked as 'wontfix' with a recommendation to use the 'package.json:files' array instead.\r\n\r\nThe reasons for using this approach instead of `package.json:files` array are:\r\n- Many known libraries in the Angular ecosystem does it ([angular/angular](https://github.com/angular/angular), [ReactiveX/rxjs](https://github.com/ReactiveX/rxjs), [cyclejs/cyclejs](https://github.com/cyclejs/cyclejs)) so they must have a reason.\r\n- There is a lot of hoo-ha/complexity with the way node.js resolve modules  for the **web projects** since during the bundling process you **must** refer to the same instance of the library. Unless the bundler (typescript, webpack etc...) provide a hack/workaround/solution to force the library to use its' own node_modules, it will not work. Publishing from sub-directory works just because the `dist/node_modules` not exists.\r\n- During development if the symlink is done against the root, when you import nested class which was not exported in the main index, you will need to refer to the `dist` as part of the path `import { something } from 'my-package/dist/something`. but once you publish from `dist` folder directly, you should somehow fix the pass by removing the `dist` during the tranpiling which is not a valid option.\r\n- The libraries being used as dependencies during development should be assigned as peerDependencies at runtime because you want the application to provide them.\r\n\r\nso to recap, we cannot just publish the package with a `dist` folder, we need to publish from `dist` directly\r\n\r\nThere are some caveats that I could think about with my suggested approach:\r\n1. The dist folder must exists with a package.json inplace before the `lerna bootstrap` process symlink the folders. \r\n2. The build process should not delete the 'dist' folder, instead it should just clear its content otherwise the symlink of dependent libraries will be broken.\r\n\r\nIMO those two caveats are manageable as:\r\n1. we can use a preinstall script to create the folder and a simple package.json file (with at least 'id','name').\r\n2. the build scripts should clear the folder content instead of `rm -rf` the folder itself.\r\n \r\n## Expected Behavior\r\n<!--- If you're describing a bug, tell us what should happen -->\r\n<!--- If you're suggesting a change/improvement, tell us how it should work -->\r\nwhen bootstrapping/publishing a package the package.json is being queried for the following config:\r\n\r\n```\r\n\"config\" : {\r\n\t\"npmDistDirectory\" : \"dist\"\r\n},\r\n```\r\n\r\nif this config exists, it will symlink to that folder during bootstrap command and will publish from that folder during  publish command\r\n\r\nusing the 'config' attribute allow using the same configuration both in `lerna` and in other [node scripts](https://docs.npmjs.com/files/package.json#config).\r\n \r\nI already modified the 'bootstrap' command in a fork [esakal/lerna](https://github.com/esakal/lerna). I didn't create a PR yet because I'm missing the 'publish' command. I will be happy to continue my work if you are going to consider this feature.\r\n\r\nYou can see it in action in our repo -  [kaltura-ng](https://github.com/kaltura/kaltura-ng) :\r\n```\r\n$ git clone https://github.com/kaltura/kaltura-ng.git\r\n$ yarn\r\n$ npm run setup\r\n$ cd kaltura-ui/node_modules/@kaltura-ng\r\n$ ll # you should see a symlink to kaltura-common/dist and kaltura-client/dist\r\n```\r\n**NOTE** - your yarn version should be 0.24.6 and above\r\n\r\n## Current Behavior\r\n<!--- If describing a bug, tell us what happens instead of the expected behavior -->\r\n<!--- If suggesting a change/improvement, explain the difference from current behavior -->\r\nn/a\r\n\r\n\r\n## Your Environment\r\n<!--- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n| Executable | Version |\r\n| ---: | :--- |\r\n| `lerna --version` | 2.0.0-rc.5 |\r\n| `yarn --version` |  v0.24.6 |\r\n\r\n| OS | Version |\r\n| --- | --- |\r\n| macOS El Capitan | 10.11.6 |\r\n<!-- For example:\r\n| macOS Sierra | 10.12.3 |\r\n| Windows 10 | 1607 |\r\n| Ubuntu | 16.10 |\r\n-->\r\n",
    "closed_at": "2017-12-09T04:34:29Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5605?v=4",
        "events_url": "https://api.github.com/users/evocateur/events{/privacy}",
        "followers_url": "https://api.github.com/users/evocateur/followers",
        "following_url": "https://api.github.com/users/evocateur/following{/other_user}",
        "gists_url": "https://api.github.com/users/evocateur/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/evocateur",
        "id": 5605,
        "login": "evocateur",
        "node_id": "MDQ6VXNlcjU2MDU=",
        "organizations_url": "https://api.github.com/users/evocateur/orgs",
        "received_events_url": "https://api.github.com/users/evocateur/received_events",
        "repos_url": "https://api.github.com/users/evocateur/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/evocateur/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/evocateur/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/evocateur"
    },
    "comments": 26,
    "comments_url": "https://api.github.com/repos/lerna/lerna/issues/901/comments",
    "created_at": "2017-06-28T08:33:57Z",
    "events_url": "https://api.github.com/repos/lerna/lerna/issues/901/events",
    "html_url": "https://github.com/lerna/lerna/issues/901",
    "id": 239090644,
    "labels": [],
    "labels_url": "https://api.github.com/repos/lerna/lerna/issues/901/labels{/name}",
    "locked": true,
    "milestone": null,
    "node_id": "MDU6SXNzdWUyMzkwOTA2NDQ=",
    "number": 901,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 18,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 18,
        "url": "https://api.github.com/repos/lerna/lerna/issues/901/reactions"
    },
    "repository_url": "https://api.github.com/repos/lerna/lerna",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/lerna/lerna/issues/901/timeline",
    "title": "[Feature] Allow custom publish subdirectory",
    "updated_at": "2018-02-04T23:05:54Z",
    "url": "https://api.github.com/repos/lerna/lerna/issues/901",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/4751797?v=4",
        "events_url": "https://api.github.com/users/esakal/events{/privacy}",
        "followers_url": "https://api.github.com/users/esakal/followers",
        "following_url": "https://api.github.com/users/esakal/following{/other_user}",
        "gists_url": "https://api.github.com/users/esakal/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/esakal",
        "id": 4751797,
        "login": "esakal",
        "node_id": "MDQ6VXNlcjQ3NTE3OTc=",
        "organizations_url": "https://api.github.com/users/esakal/orgs",
        "received_events_url": "https://api.github.com/users/esakal/received_events",
        "repos_url": "https://api.github.com/users/esakal/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/esakal/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/esakal/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/esakal"
    }
}