{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "COLLABORATOR",
    "body": "If there is data being output when a tab is closed, that can sometimes\r\nresult in the application crashing, because the renderer may still be in\r\nuse at the time is it destroyed. This PR attempts to prevent that from\r\nhappening by adding a lock in the `TermControl::Close` method.\r\n\r\nWhat we're trying to prevent is the connection thread still being\r\nactive, and potentially accessing the renderer, after it has been\r\ndestroyed. So by acquiring the terminal lock in `TermControl::Close`,\r\nafter we've stopped accepting new output, we can be sure that the\r\nconnection thread is no longer active (it holds the lock while it is\r\nprocessing output). So once we've acquired and released the lock, it\r\nshould be safe to tear down and destroy the renderer.\r\n\r\n## Validation Steps Performed\r\n\r\nWhile this crash is difficult to reproduce in general usage, it occurred\r\nquite frequently when testing my `DECPS` implementation (there is some\r\ntricky thread synchronisation, which seems more likely to trigger the\r\nissue). With this patch applied, though, those crashes have stopped\r\noccurring.\r\n\r\nI've also stepped through the shutdown code in the debugger, manually\r\nfreezing threads to get them aligned in the right way to trigger the\r\ncrash (as explained in issue #8734). Again with the patch applied, I can\r\nno longer get the crash to occur.\r\n\r\nCloses #8734",
    "closed_at": "2021-02-01T21:28:48Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/in/26612?v=4",
        "events_url": "https://api.github.com/users/msftbot%5Bbot%5D/events{/privacy}",
        "followers_url": "https://api.github.com/users/msftbot%5Bbot%5D/followers",
        "following_url": "https://api.github.com/users/msftbot%5Bbot%5D/following{/other_user}",
        "gists_url": "https://api.github.com/users/msftbot%5Bbot%5D/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/apps/msftbot",
        "id": 48340428,
        "login": "msftbot[bot]",
        "node_id": "MDM6Qm90NDgzNDA0Mjg=",
        "organizations_url": "https://api.github.com/users/msftbot%5Bbot%5D/orgs",
        "received_events_url": "https://api.github.com/users/msftbot%5Bbot%5D/received_events",
        "repos_url": "https://api.github.com/users/msftbot%5Bbot%5D/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/msftbot%5Bbot%5D/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/msftbot%5Bbot%5D/subscriptions",
        "type": "Bot",
        "url": "https://api.github.com/users/msftbot%5Bbot%5D"
    },
    "comments": 4,
    "comments_url": "https://api.github.com/repos/microsoft/terminal/issues/8982/comments",
    "created_at": "2021-02-01T01:26:30Z",
    "draft": false,
    "events_url": "https://api.github.com/repos/microsoft/terminal/issues/8982/events",
    "html_url": "https://github.com/microsoft/terminal/pull/8982",
    "id": 797874612,
    "labels": [
        {
            "color": "e60000",
            "default": false,
            "description": "It either shouldn't be doing this or needs an investigation.",
            "id": 1303203970,
            "name": "Issue-Bug",
            "node_id": "MDU6TGFiZWwxMzAzMjAzOTcw",
            "url": "https://api.github.com/repos/microsoft/terminal/labels/Issue-Bug"
        },
        {
            "color": "b60205",
            "default": false,
            "description": "Crashes are real bad news.",
            "id": 1361717293,
            "name": "Severity-Crash",
            "node_id": "MDU6TGFiZWwxMzYxNzE3Mjkz",
            "url": "https://api.github.com/repos/microsoft/terminal/labels/Severity-Crash"
        },
        {
            "color": "590059",
            "default": false,
            "description": "The new Windows Terminal.",
            "id": 1364939389,
            "name": "Product-Terminal",
            "node_id": "MDU6TGFiZWwxMzY0OTM5Mzg5",
            "url": "https://api.github.com/repos/microsoft/terminal/labels/Product-Terminal"
        },
        {
            "color": "10ff10",
            "default": false,
            "description": "Marked for automatic merge by the bot when requirements are met",
            "id": 1364956924,
            "name": "AutoMerge",
            "node_id": "MDU6TGFiZWwxMzY0OTU2OTI0",
            "url": "https://api.github.com/repos/microsoft/terminal/labels/AutoMerge"
        },
        {
            "color": "ff748c",
            "default": false,
            "description": "A description (P1)",
            "id": 1539635249,
            "name": "Priority-1",
            "node_id": "MDU6TGFiZWwxNTM5NjM1MjQ5",
            "url": "https://api.github.com/repos/microsoft/terminal/labels/Priority-1"
        }
    ],
    "labels_url": "https://api.github.com/repos/microsoft/terminal/issues/8982/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NTY0Nzc4Mjcy",
    "number": 8982,
    "performed_via_github_app": null,
    "pull_request": {
        "diff_url": "https://github.com/microsoft/terminal/pull/8982.diff",
        "html_url": "https://github.com/microsoft/terminal/pull/8982",
        "merged_at": "2021-02-01T21:28:48Z",
        "patch_url": "https://github.com/microsoft/terminal/pull/8982.patch",
        "url": "https://api.github.com/repos/microsoft/terminal/pulls/8982"
    },
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/microsoft/terminal/issues/8982/reactions"
    },
    "repository_url": "https://api.github.com/repos/microsoft/terminal",
    "state": "closed",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/microsoft/terminal/issues/8982/timeline",
    "title": "Fix crash in terminal when tab closed while data is being output",
    "updated_at": "2021-02-11T20:29:15Z",
    "url": "https://api.github.com/repos/microsoft/terminal/issues/8982",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/4181424?v=4",
        "events_url": "https://api.github.com/users/j4james/events{/privacy}",
        "followers_url": "https://api.github.com/users/j4james/followers",
        "following_url": "https://api.github.com/users/j4james/following{/other_user}",
        "gists_url": "https://api.github.com/users/j4james/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/j4james",
        "id": 4181424,
        "login": "j4james",
        "node_id": "MDQ6VXNlcjQxODE0MjQ=",
        "organizations_url": "https://api.github.com/users/j4james/orgs",
        "received_events_url": "https://api.github.com/users/j4james/received_events",
        "repos_url": "https://api.github.com/users/j4james/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/j4james/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/j4james/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/j4james"
    }
}