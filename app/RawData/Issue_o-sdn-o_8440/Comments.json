[
    {
        "author_association": "MEMBER",
        "body": "Yep, this is unfortunately true. Since the Terminal is using the UWP XAML Input stack, we only get three types of input events: key _downs_, key _ups_, and character _received_ events. Since we don't get full unicode character input from just the key down/ups, we have to rely on the character events for that. But there's no character up/down events, only _received_. So we've got to send a fake key down/up pair immediately. I'm sure if there was a way to avoid doing this, @lhecker would have thought of it by now \ud83d\ude1c \r\n\r\nFor the sake of linking: #4999 dealt with a lot of similar issues. At least conpty is now capable of _theoretically_ handling this, if only the Terminal was.",
        "created_at": "2020-11-30T02:42:53Z",
        "html_url": "https://github.com/microsoft/terminal/issues/8440#issuecomment-735513281",
        "id": 735513281,
        "issue_url": "https://api.github.com/repos/microsoft/terminal/issues/8440",
        "node_id": "MDEyOklzc3VlQ29tbWVudDczNTUxMzI4MQ==",
        "performed_via_github_app": null,
        "reactions": {
            "+1": 0,
            "-1": 0,
            "confused": 0,
            "eyes": 0,
            "heart": 0,
            "hooray": 0,
            "laugh": 0,
            "rocket": 0,
            "total_count": 0,
            "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/735513281/reactions"
        },
        "updated_at": "2020-11-30T02:42:53Z",
        "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/735513281",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/18356694?v=4",
            "events_url": "https://api.github.com/users/zadjii-msft/events{/privacy}",
            "followers_url": "https://api.github.com/users/zadjii-msft/followers",
            "following_url": "https://api.github.com/users/zadjii-msft/following{/other_user}",
            "gists_url": "https://api.github.com/users/zadjii-msft/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/zadjii-msft",
            "id": 18356694,
            "login": "zadjii-msft",
            "node_id": "MDQ6VXNlcjE4MzU2Njk0",
            "organizations_url": "https://api.github.com/users/zadjii-msft/orgs",
            "received_events_url": "https://api.github.com/users/zadjii-msft/received_events",
            "repos_url": "https://api.github.com/users/zadjii-msft/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/zadjii-msft/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zadjii-msft/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/zadjii-msft"
        }
    },
    {
        "author_association": "MEMBER",
        "body": "We could integrate the UWP based WT more deeply with our Win32 entrypoint.\r\nThat would allow us to use something like our old approach documented [here](https://github.com/microsoft/terminal/blob/ae550e0969595f062b15c2ff5cc33d4afe8ebc3f/src/interactivity/win32/consoleKeyInfo.hpp#L9-L18).",
        "created_at": "2020-11-30T08:05:51Z",
        "html_url": "https://github.com/microsoft/terminal/issues/8440#issuecomment-735624089",
        "id": 735624089,
        "issue_url": "https://api.github.com/repos/microsoft/terminal/issues/8440",
        "node_id": "MDEyOklzc3VlQ29tbWVudDczNTYyNDA4OQ==",
        "performed_via_github_app": null,
        "reactions": {
            "+1": 0,
            "-1": 0,
            "confused": 0,
            "eyes": 0,
            "heart": 0,
            "hooray": 0,
            "laugh": 0,
            "rocket": 0,
            "total_count": 0,
            "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/735624089/reactions"
        },
        "updated_at": "2020-11-30T08:05:51Z",
        "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/735624089",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/2256941?v=4",
            "events_url": "https://api.github.com/users/lhecker/events{/privacy}",
            "followers_url": "https://api.github.com/users/lhecker/followers",
            "following_url": "https://api.github.com/users/lhecker/following{/other_user}",
            "gists_url": "https://api.github.com/users/lhecker/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/lhecker",
            "id": 2256941,
            "login": "lhecker",
            "node_id": "MDQ6VXNlcjIyNTY5NDE=",
            "organizations_url": "https://api.github.com/users/lhecker/orgs",
            "received_events_url": "https://api.github.com/users/lhecker/received_events",
            "repos_url": "https://api.github.com/users/lhecker/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/lhecker/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/lhecker/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/lhecker"
        }
    },
    {
        "author_association": "MEMBER",
        "body": "I've renamed this and iceboxed it. There's some ways in which we'll want to be compatible with the console, and a great many in which we will not.\r\n\r\nThis one requires enough work (and subversion of the \"modern\" input stack) that I would bin it into the \"not\" category, but... that's me.",
        "created_at": "2020-12-03T01:11:22Z",
        "html_url": "https://github.com/microsoft/terminal/issues/8440#issuecomment-737593759",
        "id": 737593759,
        "issue_url": "https://api.github.com/repos/microsoft/terminal/issues/8440",
        "node_id": "MDEyOklzc3VlQ29tbWVudDczNzU5Mzc1OQ==",
        "performed_via_github_app": null,
        "reactions": {
            "+1": 0,
            "-1": 0,
            "confused": 0,
            "eyes": 0,
            "heart": 0,
            "hooray": 0,
            "laugh": 0,
            "rocket": 0,
            "total_count": 0,
            "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/737593759/reactions"
        },
        "updated_at": "2020-12-03T01:11:22Z",
        "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/737593759",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/189190?v=4",
            "events_url": "https://api.github.com/users/DHowett/events{/privacy}",
            "followers_url": "https://api.github.com/users/DHowett/followers",
            "following_url": "https://api.github.com/users/DHowett/following{/other_user}",
            "gists_url": "https://api.github.com/users/DHowett/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/DHowett",
            "id": 189190,
            "login": "DHowett",
            "node_id": "MDQ6VXNlcjE4OTE5MA==",
            "organizations_url": "https://api.github.com/users/DHowett/orgs",
            "received_events_url": "https://api.github.com/users/DHowett/received_events",
            "repos_url": "https://api.github.com/users/DHowett/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/DHowett/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/DHowett/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/DHowett"
        }
    },
    {
        "author_association": "COLLABORATOR",
        "body": "I've just run into this issue while trying to get certain VT input modes to work in Windows Terminal, and I'm trying to work out what the actual problem is here. I get that the key down event doesn't include character data, but we've already got code in place that can generate that character data automatically (see the `_CharacterFromKeyEvent` method). Are there known cases where that doesn't work correctly?\r\n\r\nBut lets assume the `_CharacterFromKeyEvent` method isn't good enough. Couldn't we at least use the `CharacterReceived` handler to generate the key down events (as we're doing now), but then still use the `KeyUp` handler for the corresponding key up events? There may then be edge cases where the character data could be incorrect for the key up, but would that actually affect anyone? Because a typical `WM_KEYUP` message wouldn't include that info anyway.\r\n\r\nAnd if that really is still a concern, another approach we could take would be to save the most recent character in the `CharacterReceived` handler (just store it in an array mapped to the scan code), and then the `KeyUp` handler could easily look up the corresponding character data for a particular scan code when the key is released. Even with multiple keys pressed simultaneously I would think the scan code should suffice as a unique id.\r\n\r\nAre there more factors at play here that I'm overlooking? Or does anyone have suggestions for sample keystrokes I should be testing that would be expected to fail? Because everything I've tried so far seemed to work OK (or at least no worse than the current implementation).",
        "created_at": "2022-09-01T21:56:50Z",
        "html_url": "https://github.com/microsoft/terminal/issues/8440#issuecomment-1234823877",
        "id": 1234823877,
        "issue_url": "https://api.github.com/repos/microsoft/terminal/issues/8440",
        "node_id": "IC_kwDOBfbO8M5JmerF",
        "performed_via_github_app": null,
        "reactions": {
            "+1": 0,
            "-1": 0,
            "confused": 0,
            "eyes": 0,
            "heart": 0,
            "hooray": 0,
            "laugh": 0,
            "rocket": 0,
            "total_count": 0,
            "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/1234823877/reactions"
        },
        "updated_at": "2022-09-01T21:56:50Z",
        "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/1234823877",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/4181424?v=4",
            "events_url": "https://api.github.com/users/j4james/events{/privacy}",
            "followers_url": "https://api.github.com/users/j4james/followers",
            "following_url": "https://api.github.com/users/j4james/following{/other_user}",
            "gists_url": "https://api.github.com/users/j4james/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/j4james",
            "id": 4181424,
            "login": "j4james",
            "node_id": "MDQ6VXNlcjQxODE0MjQ=",
            "organizations_url": "https://api.github.com/users/j4james/orgs",
            "received_events_url": "https://api.github.com/users/j4james/received_events",
            "repos_url": "https://api.github.com/users/j4james/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/j4james/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/j4james/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/j4james"
        }
    },
    {
        "author_association": "MEMBER",
        "body": "> Are there more factors at play here that I'm overlooking?\r\n\r\nProbably there aren't -- I think you've by this point investigated it deeper than the rest of us in recent history. We just got another dupe for it, and I _am_ wondering if there's something we can do about it...\r\n\r\nWhile we're breaking input, and all. \ud83d\ude01 ",
        "created_at": "2023-04-06T00:12:35Z",
        "html_url": "https://github.com/microsoft/terminal/issues/8440#issuecomment-1498318068",
        "id": 1498318068,
        "issue_url": "https://api.github.com/repos/microsoft/terminal/issues/8440",
        "node_id": "IC_kwDOBfbO8M5ZToT0",
        "performed_via_github_app": null,
        "reactions": {
            "+1": 1,
            "-1": 0,
            "confused": 0,
            "eyes": 0,
            "heart": 0,
            "hooray": 0,
            "laugh": 0,
            "rocket": 0,
            "total_count": 1,
            "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/1498318068/reactions"
        },
        "updated_at": "2023-04-06T00:19:01Z",
        "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/1498318068",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/189190?v=4",
            "events_url": "https://api.github.com/users/DHowett/events{/privacy}",
            "followers_url": "https://api.github.com/users/DHowett/followers",
            "following_url": "https://api.github.com/users/DHowett/following{/other_user}",
            "gists_url": "https://api.github.com/users/DHowett/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/DHowett",
            "id": 189190,
            "login": "DHowett",
            "node_id": "MDQ6VXNlcjE4OTE5MA==",
            "organizations_url": "https://api.github.com/users/DHowett/orgs",
            "received_events_url": "https://api.github.com/users/DHowett/received_events",
            "repos_url": "https://api.github.com/users/DHowett/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/DHowett/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/DHowett/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/DHowett"
        }
    },
    {
        "author_association": "COLLABORATOR",
        "body": "I've got an old branch with my initial simple proposal (relying on `_CharacterFromKeyEvent` to generate the character data), which I can turn into a PR tomorrow if you'd like. It's only a couple of lines, so it's not a big deal if we need to drop it in favor of something more complicated.",
        "created_at": "2023-04-06T00:41:24Z",
        "html_url": "https://github.com/microsoft/terminal/issues/8440#issuecomment-1498340800",
        "id": 1498340800,
        "issue_url": "https://api.github.com/repos/microsoft/terminal/issues/8440",
        "node_id": "IC_kwDOBfbO8M5ZTt3A",
        "performed_via_github_app": null,
        "reactions": {
            "+1": 0,
            "-1": 0,
            "confused": 0,
            "eyes": 0,
            "heart": 0,
            "hooray": 0,
            "laugh": 0,
            "rocket": 0,
            "total_count": 0,
            "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/1498340800/reactions"
        },
        "updated_at": "2023-04-06T00:41:24Z",
        "url": "https://api.github.com/repos/microsoft/terminal/issues/comments/1498340800",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/4181424?v=4",
            "events_url": "https://api.github.com/users/j4james/events{/privacy}",
            "followers_url": "https://api.github.com/users/j4james/followers",
            "following_url": "https://api.github.com/users/j4james/following{/other_user}",
            "gists_url": "https://api.github.com/users/j4james/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/j4james",
            "id": 4181424,
            "login": "j4james",
            "node_id": "MDQ6VXNlcjQxODE0MjQ=",
            "organizations_url": "https://api.github.com/users/j4james/orgs",
            "received_events_url": "https://api.github.com/users/j4james/received_events",
            "repos_url": "https://api.github.com/users/j4james/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/j4james/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/j4james/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/j4james"
        }
    }
]